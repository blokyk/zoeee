# NixOS secret management for the average person

I currently run this site on a humble VPS running NixOS. There are many reasons to use it; in no particular order:

- Fully declarative OS config
- Integrated, *reliable* system config rollback
- Reproducible environment/OS
- No more dependency hell
- Active community / large package selection
- `nix-shell`
- etc.

I'll expand later on why I chose nix, but unfortunately for me, a Known Dev-Ops Haterâ„¢, these are the sorts of traits that attract DevOps people like nothing else. Documentation, guides, and blog posts are seemingly all written with the unique goal of testing the [semantic satiation](https://en.wikipedia.org/wiki/Semantic_satiation) limit of the words "deploy" and "scalable". But while every other nix user out there seemingly has one MacBook, two desktops, and at least 5 servers, I am but a humble commoner. My goal is simply to manage a single private server; no CI/CD environment shenanigans, no organizational secret sharing whatever; just a simple `ssh zoeee.net 'echo gay >> site.html'` and that's it.

However, the most attractive of these to me was the first: everything about the system is configured through **one** set of file in **one** folder. It's been an absolute joy for the cant-remember-where-i-put-the-conf-quirk-for-foo scatter brain I can be, since everything is declared in one place, instead of
nestled in some deep subfolders of `/etc`. Instead of tracking down which specific file I need to touch to open a port on my firewall, I can just do this:

```nix
networking.firewall.allowedTCPPorts = [ 22 80 443 1234 ];
```

Oh joyous days!

Similarly, to configure a service like `suwayomi`, I can simply describe its configuration in a sort of augmented-JSON format (which is the *Nix language*):

```nix
services.suwayomi-server = {
    enable = true;
    settings.server.port = 1234;
}
```

And the code wrote by the contributors to [`NixOS/nixpkgs`](https://github.com/NixOS/nixpkgs) will take care of generating the corresponding Suwayomi config file, put it in the right place, add a systemd unit file to manage the service, set the right permissions on the right files, etc. And all I had to do was right 4 lines of code! In addition to being forgetful, I am also criminally lazy, so this is perfect for me. The last thing I want to be doing is manage individual file permissions...

And that's where we run into a problem. Because the one thing that you most likely *don't* want next to your otherwise-publishable config files is your password.
